> [!NOTE]
> This README was generated by [Claude Code](https://github.com/anthropics/claude-code), get the ZH version from [here](./README.zh.md).

![cover](./cover.png)

# go-sqlite

[![pkg](https://pkg.go.dev/badge/github.com/pardnchiu/go-sqlite.svg)](https://pkg.go.dev/github.com/pardnchiu/go-sqlite)
[![tag](https://img.shields.io/github/v/tag/pardnchiu/go-sqlite?label=release)](https://github.com/pardnchiu/go-sqlite/releases)
[![license](https://img.shields.io/github/license/pardnchiu/go-sqlite)](LICENSE)

> A lightweight Go SQLite query builder with fluent chainable API for simplified CRUD operations, supporting Context propagation and conflict handling strategies.

## Table of Contents

- [Features](#features)
- [Installation](#installation)
- [Usage](#usage)
- [API Reference](#api-reference)
- [License](#license)
- [Author](#author)
- [Stars](#stars)

## Features

- **Chainable API**: Fluent query building syntax with `Table().Where().Get()` chaining
- **Multi-database Connection Management**: Singleton Connector manages multiple SQLite databases
- **Full CRUD Support**: Complete Create, Insert, Select, Update operations
- **Context Propagation**: Timeout and cancellation support via `Context(ctx)` chaining
- **Conflict Handling Strategies**: Supports Ignore, Replace, Abort, Fail, Rollback
- **Rich WHERE Conditions**: Eq, NotEq, Gt, Lt, Ge, Le, In, NotIn, Null, NotNull, Between
- **Column Validation**: Automatic SQL reserved word and identifier format checking
- **WAL Mode**: Enabled by default for improved concurrency performance

## Installation

```bash
go get github.com/pardnchiu/go-sqlite
```

## Usage

### Initialize Connection

```go
package main

import (
    "log"
    goSqlite "github.com/pardnchiu/go-sqlite"
)

func main() {
    // Create connection (singleton pattern, can register multiple databases)
    conn, err := goSqlite.New(goSqlite.Config{
        Key:      "main",           // Optional, defaults to filename
        Path:     "./data.db",
        Lifetime: 3600,             // Optional, connection lifetime in seconds
    })
    if err != nil {
        log.Fatal(err)
    }
    defer conn.Close()
}
```

### Create Table

```go
builder, _ := conn.DB("main")
err := builder.Table("users").Create(
    goSqlite.Column{Name: "id", Type: "INTEGER", IsPrimary: true, AutoIncrease: true},
    goSqlite.Column{Name: "name", Type: "TEXT", IsNullable: false},
    goSqlite.Column{Name: "email", Type: "TEXT", IsUnique: true},
    goSqlite.Column{Name: "age", Type: "INTEGER", Default: 0},
)
```

### Insert Data

```go
builder, _ := conn.DB("main")

// Basic insert, returns LastInsertId
id, err := builder.Table("users").Insert(map[string]any{
    "name":  "Alice",
    "email": "alice@example.com",
    "age":   25,
})

// With Context
ctx, cancel := context.WithTimeout(context.Background(), 5*time.Second)
defer cancel()

id, err = builder.Table("users").
    Context(ctx).
    Insert(map[string]any{
        "name": "Bob",
    })

// Conflict handling
id, err = builder.Table("users").
    Conflict(goSqlite.Ignore).
    Insert(map[string]any{"email": "alice@example.com"})
```

### Query Data

```go
builder, _ := conn.DB("main")

// Query multiple rows
rows, err := builder.Table("users").
    Select("id", "name", "email").
    WhereGt("age", 18).
    OrderBy("name", goSqlite.Asc).
    Limit(10).
    Offset(0).
    Get()

// Query single row
row, err := builder.Table("users").
    WhereEq("id", 1).
    First()

// Count
count, err := builder.Table("users").
    WhereNotNull("email").
    Count()

// Query with total count (for pagination)
rows, err := builder.Table("users").
    Total().
    Limit(10).
    Get()
```

### Update Data

```go
builder, _ := conn.DB("main")

// Basic update, returns RowsAffected
affected, err := builder.Table("users").
    WhereEq("id", 1).
    Update(map[string]any{"name": "Alice Updated"})

// Increment numeric value
_, err = builder.Table("users").
    WhereEq("id", 1).
    Increase("login_count", 1).
    Update()

// Toggle boolean
_, err = builder.Table("users").
    WhereEq("id", 1).
    Toggle("is_active").
    Update()
```

### Compound Conditions

```go
builder, _ := conn.DB("main")

// AND conditions
rows, _ := builder.Table("users").
    WhereGe("age", 18).
    WhereLe("age", 30).
    WhereNotNull("email").
    Get()

// OR conditions
rows, _ := builder.Table("users").
    WhereEq("status", "active").
    OrWhereEq("role", "admin").
    Get()

// IN condition
rows, _ := builder.Table("users").
    WhereIn("id", []any{1, 2, 3}).
    Get()

// BETWEEN condition
rows, _ := builder.Table("users").
    WhereBetween("age", 20, 30).
    Get()
```

### JOIN Queries

```go
builder, _ := conn.DB("main")

rows, _ := builder.Table("orders").
    Select("orders.id", "users.name", "orders.total").
    LeftJoin("users", "users.id = orders.user_id").
    WhereGt("orders.total", 100).
    Get()
```

### Raw SQL

```go
// Execute via Connector
rows, err := conn.Query("main", "SELECT * FROM users WHERE age > ?", 18)

// Or get *sql.DB directly
builder, _ := conn.DB("main")
db := builder.Raw()
rows, err := db.Query("SELECT * FROM users")
```

## API Reference

### Config

| Field | Type | Description |
|-------|------|-------------|
| `Key` | `string` | Database identifier key, optional, defaults to filename |
| `Path` | `string` | SQLite file path |
| `Lifetime` | `int` | Maximum connection lifetime in seconds, optional |

### Connector Methods

| Method | Description |
|--------|-------------|
| `New(Config) (*Connector, error)` | Create or get Connector singleton |
| `DB(key string) (*Builder, error)` | Get Builder for specified database |
| `Query(key, query string, args ...any)` | Execute raw query |
| `QueryContext(ctx, key, query string, args ...any)` | Execute raw query with Context |
| `Exec(key, query string, args ...any)` | Execute raw command |
| `ExecContext(ctx, key, query string, args ...any)` | Execute raw command with Context |
| `Close()` | Close all database connections |

### Builder Methods

| Category | Method | Description |
|----------|--------|-------------|
| **Basic** | `Table(name string)` | Specify table |
| | `Context(ctx context.Context)` | Set Context |
| | `Raw() *sql.DB` | Get underlying *sql.DB |
| **Schema** | `Create(columns ...Column)` | Create table |
| **Insert** | `Insert(data ...map[string]any) (int64, error)` | Insert data, returns LastInsertId |
| | `Conflict(conflict) *Builder` | Set conflict handling strategy |
| **Select** | `Select(columns ...string)` | Specify columns to select |
| | `Get() (*sql.Rows, error)` | Get multiple rows |
| | `First() (*sql.Row, error)` | Get single row |
| | `Count() (int64, error)` | Get count |
| | `Total() *Builder` | Enable total count calculation |
| **Where** | `Where(condition string, args ...any)` | Custom WHERE condition |
| | `WhereEq / WhereNotEq` | Equal / Not equal |
| | `WhereGt / WhereLt` | Greater than / Less than |
| | `WhereGe / WhereLe` | Greater or equal / Less or equal |
| | `WhereIn / WhereNotIn` | IN / NOT IN |
| | `WhereNull / WhereNotNull` | IS NULL / IS NOT NULL |
| | `WhereBetween` | BETWEEN |
| | `OrWhere...` | OR versions of condition methods |
| **Order/Limit** | `OrderBy(column string, direction ...direction)` | Order by (Asc/Desc) |
| | `Limit(num ...int)` | Limit rows |
| | `Offset(num int)` | Offset |
| **JOIN** | `Join(table, on string)` | INNER JOIN |
| | `LeftJoin(table, on string)` | LEFT JOIN |
| **Update** | `Update(data ...map[string]any) (int64, error)` | Update data, returns RowsAffected |
| | `Increase(column string, num ...int)` | Increment numeric value |
| | `Decrease(column string, num ...int)` | Decrement numeric value |
| | `Toggle(column string)` | Toggle boolean |

### Conflict Strategies

| Constant | Description |
|----------|-------------|
| `Ignore` | Ignore conflict, skip insert |
| `Replace` | Delete old row and insert new |
| `Abort` | Abort transaction and rollback (default) |
| `Fail` | Abort but preserve previous changes |
| `Rollback` | Rollback entire transaction |

### Column Structure

| Field | Type | Description |
|-------|------|-------------|
| `Name` | `string` | Column name |
| `Type` | `string` | SQLite type (INTEGER, TEXT, REAL, BLOB) |
| `IsPrimary` | `bool` | Primary key |
| `AutoIncrease` | `bool` | Auto increment |
| `IsNullable` | `bool` | Nullable |
| `IsUnique` | `bool` | Unique constraint |
| `Default` | `any` | Default value |
| `ForeignKey` | `*Foreign` | Foreign key configuration |

## License

This project is licensed under the MIT License - see the [LICENSE](LICENSE) file for details.

## Author

<img src="https://avatars.githubusercontent.com/u/25631760" align="left" width="96" height="96" style="margin-right: 0.5rem;">

<h4 style="padding-top: 0">邱敬幃 Pardn Chiu</h4>

<a href="mailto:dev@pardn.io" target="_blank">
<img src="https://pardn.io/image/email.svg" width="48" height="48">
</a> <a href="https://linkedin.com/in/pardnchiu" target="_blank">
<img src="https://pardn.io/image/linkedin.svg" width="48" height="48">
</a>

## Stars

[![Star](https://starchart.cc/pardnchiu/go-sqlite.svg?variant=adaptive)](https://starchart.cc/pardnchiu/go-sqlite)

***

©️ 2026 [邱敬幃 Pardn Chiu](https://linkedin.com/in/pardnchiu)
